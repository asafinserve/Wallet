<!DOCTYPE html>
<head>
   <title>Credit Card</title>
   <link rel="icon" href="../Assets/main-icon.png">
   <meta name="viewport" content="width=device-width, initial-scale=1.0">
   <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.8.1/css/all.css">
   <script src="../Assets/420eab8243.js" ></script>
</head>
<style>
    @import url('https://fonts.googleapis.com/css2?family=Open+Sans&display=swap');
   .centre
   {
   text-align: center;
   }
   .button {
   padding: 15px 25px;
   font-size: 20px;
   text-align: center;
   cursor: pointer;
   outline: none;
   color: #fff;
   background-color: peru;
   border: none;
   border-radius: 15px;
   box-shadow: 0 9px #999;
   }
   .button:hover {background-color: darkgoldenrod}
   .button:active {
   background-color: peru;
   box-shadow: 0 5px #666;
   transform: translateY(4px);
   }
   .dotted{
      border-style: solid;
   }
   .content {
   padding: 0 18px;
   display: none;
   overflow: hidden;
   }
   .center{
   margin: auto;
   width: 30%;
   align-items: center;  
   padding: 10px;
   }   
   .red
   {
    color:red;
   }
   .card {
        box-shadow: 0 4px 8px 0 rgba(0,0,0,0.2);
        transition: 0.3s;
        /*width: 40%;*/
    }

    .card:hover {
        box-shadow: 0 8px 16px 0 rgba(0,0,0,0.2);
    }

    .container {
        padding: 2px 16px;
    }
    .vertical-center {
  margin: 0;
  position: absolute;
  top: 50%;
  -ms-transform: translateY(-50%);
  transform: translateY(-50%);
}

   .rectangle {
   width: 200px;
   height: 100px;
   border: 1px solid black;
   text-align: center;
   display: inline-block;
   line-height: 50px;
   font-weight: bold;
   font-size: 20px;
   }
   .required::after {
   color: red;
   }
   th, td
   {
  padding-right: 20px;

   }
   *{
   list-style: none;
   text-decoration: none;
   margin: 0;
   padding: 0;
   box-sizing: border-box;
   font-family: 'Open Sans', sans-serif;
   }
   body{
   background: #f5f6fa;
   }
   .wrapper .sidebar{
   background: rgb(5, 68, 104);
   position: fixed;
   top: 0;
   left: 0;
   width: 225px;
   height: 100%;
   padding: 20px 0;
   transition: all 0.5s ease;
   }
   .wrapper .sidebar .profile{
   margin-bottom: 30px;
   text-align: center;
   }
   .wrapper .sidebar .profile img{
   display: block;
   width: 100px;
   height: 100px;
   border-radius: 50%;
   margin: 0 auto;
   }
   .wrapper .sidebar .profile h3{
   color: #ffffff;
   margin: 10px 0 5px;
   }
   .wrapper .sidebar .profile p{
   color: rgb(206, 240, 253);
   font-size: 14px;
   }
   .wrapper .sidebar ul li a{
   display: block;
   padding: 13px 30px;
   border-bottom: 1px solid #10558d;
   color: rgb(241, 237, 237);
   font-size: 16px;
   position: relative;
   }
   .wrapper .sidebar ul li a .icon{
   color: #dee4ec;
   width: 30px;
   display: inline-block;
   }
   .wrapper .sidebar ul li a:hover,
   .wrapper .sidebar ul li a.active{
   color: #0c7db1;
   background:white;
   border-right: 2px solid rgb(5, 68, 104);
   }
   .wrapper .sidebar ul li a:hover .icon,
   .wrapper .sidebar ul li a.active .icon{
   color: #0c7db1;
   }
   .wrapper .sidebar ul li a:hover:before,
   .wrapper .sidebar ul li a.active:before{
   display: block;
   }
   .collapsible {
   display: none;
   }
   .collapsible.active {
   display: block;
   }
   .collapsible-button {
   background-color: transparent;
   border: none;
   color: #000;
   font-size: 24px;
   cursor: pointer;
   position: absolute;
   top: 10px;
   left: 10px;
   }
    .centeer {
  margin-left: auto;
  margin-right: auto;
}

</style>
<body>
   <h2 class="centre">Wallet: Credit Cards</h2>
   <button class="collapsible-button" id="coll-button">&#9776;</button>
   <div class="collapsible">
      <div class="wrapper">
         <!--Top menu -->
         <div class="sidebar">
            <button class="collapsible-button" id="dis-collapsible-button" style="color:white">&#9776;</button>
            <br>
            <div class="profile">
                <i class="fa-regular fa-user fa-2xl" style="color: #f7f9fd;"></i>
                <br>    
                <h3 id="name_ussser"></h3>
                <p id="user_name"></p>
                <br>
                <button onclick="logoutFunction()">Logout</button>
            </div>
            <ul>
                <li>
                    <a href="../index.html">
                        <span class="icon"><i class="fas fa-home"></i></span>
                        <span class="item">Home</span>
                    </a>
                </li>
                <li>
                    <a href="#" class="active">
                        <span class="icon"><i class="fa-regular fa-credit-card"></i></span>
                        <span class="item">Credit Cards</span>
                    </a>
                </li>
                <li>
                    <a href="Bank.html">
                        <span class="icon"><i class="fa-solid fa-building-columns"></i></span>
                        <span class="item">Banks</span>
                    </a>
                </li>
                <li>
                    <a href="Cash.html">
                        <span class="icon"><i class="fa-solid fa-sack-dollar"></i></span>
                        <span class="item">Cash</span>
                    </a>
                </li>
                <li>
                    <a href="Settings.html">
                        <span class="icon"><i class="fa-solid fa-gear"></i></span>
                        <span class="item">Settings</span>
                    </a>
                </li>
            </ul>
        </div>
      </div>
   </div>
   <br>
   <p class="centre" id="cur_balance" style="font-size: 20px;"></p>
   <br>
   <form class="centre">
      <button class="button" id="addBtn" onclick="goto()">Add Credit Card</button>
      <br><br>
      
      <button class="button" id="inBtn" onclick="money_in()">Bill Payment of a card</button>
      <br><br>
      <button class="button" id="outBtn" onclick="money_out()">Transaction using a card</button>
   </form>
   <div id="details_div" class="margin: auto;
      display: block;
      ">
      <br>
      <h2 class="centre">Transactions</h2> 
      <h3 class="centre">Select a card in the table above</h3>
      <p class="centre" id="card_buttons">
        <h3 id="card_name_selected"></h3>
        <form id="to_check" style="display:none">
            <label>From: </label>
            <input type="date" id="from_date" />
            <label>To: </label>
            <input type="date" id="to_date" />
            <br><br>
            <button onclick="getTransactions()">Get Transactions</button>
            <br>
            <br>
        </form>
      </p>
      <table id="transactions_table" style="display:none">
         <thead>
            <th style="margin-left: 10px; margin-right:10px;">Date</th>
            <th style="margin-left: 10px; margin-right:10px;">Particulars</th>
            <th style="margin-left: 10px; margin-right:10px;">Credit Card</th>
            <th style="margin-left: 10px; margin-right:10px;">Type</th>
            <th style="margin-left: 10px; margin-right:10px;">Amount</th>
            <th style="margin-left: 10px; margin-right:10px;">Actions</th>
         </thead>
         <tbody id="ttbody">

         </tbody>
      </table>
      
   </div>
</body>
<script type="text/javascript" charset="utf8" src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="../Assets/functions.js"></script>
<script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>
<link rel="stylesheet" src="https://cdn.datatables.net/1.13.6/css/jquery.dataTables.min.css">

<script src="../localforage.js"></script>
<script>

    document.getElementById('card_buttons').visibility=false
        if(window.navigator.onLine==false)
    {
        alert("You are offline, get back online to login or signup to Wallet")
        document.getElementById('addBtn').disabled=true
        document.getElementById('inBtn').disabled=true
        document.getElementById('outBtn').disabled=true
    }
function localStorageGetItem(vallue)
    {
        return JSON.parse(localStorage.getItem("Wallet"))[vallue]
    }    

    document.getElementById("name_ussser").innerHTML = localStorageGetItem("NameUser")
    document.getElementById("user_name").innerHTML = localStorageGetItem("user_id")
    const collapsibleButton = document.querySelector('.collapsible-button');
   const menu = document.querySelector('.collapsible');
   
   collapsibleButton.addEventListener('click', () => {
   menu.classList.toggle('active');
   });
   
   
   const discollapisbleButton = document.getElementById("dis-collapsible-button");
   discollapisbleButton.addEventListener('click', () => {
   menu.classList.remove('active')
   });
   
  </script>
<script>    
    function getTransactions()
    {
        event.preventDefault()  
        fromDate = document.getElementById("from_date").value
        toDate = document.getElementById("to_date").value
        if(fromDate==""||toDate=="")
        {
            alert("Enter period between which you require the transactions")
        }
        else
        {
            cardselected = document.getElementById("card_name_selected").innerHTML
            transactions = localStorageGetItem("CREDIT CARDS")["TRANSACTIONS"]
            toAdd = []
            for (transaction of transactions)
            {
                if(transaction.Particulars=="Modifying Entry" && transaction.Narration=="Being modification entry passed")
                {}
                else
                {
                    if(transaction.CreditCard==cardselected && new Date(transaction.Date)>=new Date(fromDate) && new Date(transaction.Date)<=new Date(toDate))
                    {
                        toAdd.push(transaction)
                    }
                }
            }
            toAdd.forEach(add)
           if(document.getElementById("transactions_table").rows.length==1)
           {
           var no_trx = document.createElement("h2")
           no_trx.id="no_trx"
           no_trx.innerHTML="No transactions found"
           no_trx.style.cssText = 'text-align:center;';
           document.getElementById("details_div").appendChild(no_trx)
           }
           else
        {
                document.getElementById("transactions_table").style.display="block"
                try
                {
                    document.getElementById("no_trx").style.display="none"
                }
                catch
                {

                }
        }
           $(document).ready(function() {
    $('#transactions_table').DataTable();
    $(".dataTables_empty").empty();
});

        }
    }
    function goto()
   {
    event.preventDefault()
    window.location.href="Settings.html?addType=CC"
   }

   function isStringInList(string, list) {
       var lowercaseString = string.toLowerCase();
       return list.map(item => item.toLowerCase()).includes(lowercaseString);
       }

   
   function moneyadded_in()
   {
       event.preventDefault()
       if(document.getElementById("amount_transaction").value=="" || document.getElementById("bank_select").options[document.getElementById("bank_select").selectedIndex].text=="Select a credit card" || document.getElementById("payment_select").options[document.getElementById("payment_select").selectedIndex].text=="How did you pay the amount?")
       {
           alert("Please enter all the details. The narration is optional")
       }
       else
       {
           data = (localStorageGetItem("CREDIT CARDS"))
           new_object = new Object()
           new_object.Type = "Cr"
           new_object.Particulars="Payment made to Card"
           new_object.Amount = document.getElementById("amount_transaction").value
           selected = document.getElementById("payment_select").options[document.getElementById("payment_select").selectedIndex].text
           if(selected.includes("Cash"))
           {
                data_cash = (localStorageGetItem("CASH"))
                cash_balance_to = parseFloat(data_cash["CASH_BALANCE"])
                console.log(cash_balance_to)
                if (cash_balance_to<parseFloat(document.getElementById("amount_transaction").value))
                {
                        alert(`Insufficient cash balance`)
                }
                else
                {
                    new_object.Account="Cash"
                    new_object.CreditCard = (document.getElementById("bank_select").options[document.getElementById("bank_select").selectedIndex].text).split(" - ")[0]
                    new_cashbalance = parseFloat(cash_balance_to)-parseFloat(document.getElementById("amount_transaction").value)
                    console.log(new_cashbalance)
                    new_cashobject = new Object()
                    new_cashobject.Date = `${new Date().getFullYear()}-${new Date().getMonth()+1}-${new Date().getDate()}`
                    new_cashobject.Particulars = `Payment of ${(document.getElementById("bank_select").options[document.getElementById("bank_select").selectedIndex].text).split(" - ")[0]} Credit Card`
                    new_cashobject.Type = "Dr"
                    new_cashobject.Amount = document.getElementById("amount_transaction").value
                    new_cashobject.Narration = document.getElementById("narration").value
                    data_cash["TRANSACTIONS"].push(new_cashobject)
                    data_cash["TRXNUM"]+=1
                    data_cash["TRANSACTIONS"].sort((a, b) => new Date(a.Date) - new Date(b.Date));
                    data_cash["CASH_BALANCE"]=new_cashbalance
                    new_object["TRXNUM"]=data_cash["TRXNUM"]
                    oridata = JSON.parse(localStorage.getItem("Wallet"))
                    oridata["CASH"]=data_cash
                    data["TRANSACTIONS"].push(new_object)
                    data["TRXNUM"]+=1
                    new_object.TRXNUM=data["TRXNUM"]
                    data["TRANSACTIONS"].sort((a, b) => new Date(a.Date) - new Date(b.Date));
                    balance_outstanding = data[document.getElementById("bank_select").options[document.getElementById("bank_select").selectedIndex].text.split(" - ")[0]]["BalanceOutstanding"]-parseFloat(document.getElementById("amount_transaction").value)
                    console.log(balance_outstanding)
                    data[document.getElementById("bank_select").options[document.getElementById("bank_select").selectedIndex].text.split(" - ")[0]]["BalanceOutstanding"]=balance_outstanding
                    oridata["CREDIT CARDS"]=data
                    setToStorage(JSON.stringify(oridata))
                    alert("Saved successfully")
                    window.location.reload()
                }
           }
           else
           {
                bankname = selected.split(" - ")[0]
                data_banks = (localStorageGetItem("BANKS"))
                bank_balance = parseFloat(data_banks[bankname])
                if (bank_balance<parseFloat(document.getElementById("amount_transaction").value))
                {
                    alert(`Insufficient balance in ${bankname}`)
                }
                else
                {
                    new_bankbalance = parseFloat(bank_balance)-parseFloat(document.getElementById("amount_transaction").value)
                    console.log(new_bankbalance)
                    new_cashobject = new Object()
                    new_cashobject.Date = `${new Date().getFullYear()}-${new Date().getMonth()+1}-${new Date().getDate()}`
                    new_object.Account = bankname
                    new_cashobject.Particulars = `Payment of ${(document.getElementById("bank_select").options[document.getElementById("bank_select").selectedIndex].text).split(" - ")[0]} Credit Card`
                    new_cashobject.Type = "Dr"
                    new_cashobject.BankAccount = bankname
                    new_object.CreditCard = (document.getElementById("bank_select").options[document.getElementById("bank_select").selectedIndex].text).split(" - ")[0]
                    new_cashobject.Amount = document.getElementById("amount_transaction").value
                    new_cashobject.Narration = document.getElementById("narration").value
                    data_banks["TRANSACTIONS"].push(new_cashobject)
                    data_banks["TRXNUM"]+=1
                    data_banks["TRANSACTIONS"].sort((a, b) => new Date(a.Date) - new Date(b.Date));
                    new_object["TRXNUM"]=data_banks["TRXNUM"]
                    data_banks[bankname]=new_bankbalance
                    oridata = JSON.parse(localStorage.getItem("Wallet"))
                    oridata["BANKS"]=data_banks
                    new_object.Narration = document.getElementById("narration").value
                    data["TRANSACTIONS"].push(new_object)
                    data["TRXNUM"]+=1
                    new_object.TRXNUM=data["TRXNUM"]
                    data["TRANSACTIONS"].sort((a, b) => new Date(a.Date) - new Date(b.Date));
                    balance_outstanding = data[document.getElementById("bank_select").options[document.getElementById("bank_select").selectedIndex].text.split(" - ")[0]]["BalanceOutstanding"]-parseFloat(document.getElementById("amount_transaction").value)
                    
                    data[document.getElementById("bank_select").options[document.getElementById("bank_select").selectedIndex].text.split(" - ")[0]]["BalanceOutstanding"]=balance_outstanding
                    oridata["CREDIT CARDS"]=data
                    setToStorage(JSON.stringify(oridata))
                    alert("Saved successfully")
                    window.location.reload()
                }
           }
       }
   }
   function money_in()
   {
       event.preventDefault()
       document.getElementById("details_div").innerHTML=""
       document.getElementById("details_div").innerHTML+='\
       <br>\
       <h2 class="centre">Bill Payment of a Card</h2>\
       <br><select id="bank_select" class="margin: auto; display: block;" onchange="doTask()"><option>Select a credit card</option></select>\
       <br><input id="amount_transaction" class="margin: auto; display: block;" type="number" placeholder="Enter the bill amount">\
       <br><ul id="list1"></ul>\
       <br><select class="margin: auto; display: block;" id="payment_select"><option id="main_option">How did you pay the amount?</option></select>\
       <br><input id="narration" class="margin: auto; display: block;" type="text" placeholder="Enter narration"></p>\
       <br><button id="add_btn"onclick="moneyadded_in()">Add transaction</button>'
       data = (localStorageGetItem("CREDIT CARDS"))
        
        for (keey in data)
        {
            if(keey == "NO_OF_CARDS"|| keey=="TRANSACTIONS" ||keey=="TRXNUM")
            {

            }
            else
            {
                var newElement = document.createElement("option")
                newElement.innerHTML = keey
                document.getElementById("bank_select").add(newElement)
            }
        }
       if (localStorageGetItem("CASH")==null && localStorageGetItem("BANKS")==null)
       {
        document.getElementById("main_option").innerHTML="You don't have any payment options set up"
        document.getElementById("add_btn").disabled = true
       }
       else
       {
         try_cash = (localStorageGetItem("CASH"))
         if(try_cash==null)
         {

         }
         else
         {
            var li = document.createElement("option")
            li.innerHTML = `Cash - ₹${try_cash["CASH_BALANCE"]}`
            li.addEventListener("click", function(){})
            document.getElementById("payment_select").appendChild(li)   
         }
         try_bank = (localStorageGetItem("BANKS"))
         if(try_bank==null)
         {

         }
         else
         {
            for (var kkkeey in try_bank)
            {
                if(kkkeey=="NO_OF_BANKACCOUNTS"||kkkeey=="TRANSACTIONS"||kkkeey=="TRXNUM")
                {
                    
                }
                else
                {
                    var li = document.createElement("option")
                    li.innerHTML = `${kkkeey} - ₹${try_bank[kkkeey]}`
                    document.getElementById("payment_select").appendChild(li)  
   
                }
            }
         }
       }
    }
    function doTask()
    {
        data = (localStorageGetItem("CREDIT CARDS"))
        
        for (keey in data)
        {
            if(keey==(document.getElementById("bank_select").options[document.getElementById("bank_select").selectedIndex].text).split(" - ")[0])
            {
                
                balance = data[keey]["BalanceOutstanding"]
                document.getElementById("amount_transaction").value=balance
                if(balance==0)
                {
                    document.getElementById("add_btn").disabled=true
                }
                else
                {
                    document.getElementById("add_btn").disabled=false
                }
            }
        }
    }
   function moneyadded_out()
   {
       event.preventDefault()
       if(document.getElementById("date_transaction").value=="" || document.getElementById("particulars_transaction").value=="" || document.getElementById("amount_transaction").value=="" || document.getElementById("bank_select").options[document.getElementById("bank_select").selectedIndex].text=="Select a credit card")
       {
           alert("Please enter all the details. The narration is optional")
       }
       else
       {
           data = (localStorageGetItem("CREDIT CARDS"))
           new_object = new Object()
           new_object.Date = document.getElementById("date_transaction").value
           new_object.Particulars = document.getElementById("particulars_transaction").value
           if(localStorageGetItem("particulars_ai")==null)
           {
               array_part =[]
               array_part.push(document.getElementById("particulars_transaction").value)
               oridata = JSON.parse(localStorage.getItem("Wallet"))
               oridata["particulars_ai"]=array_part
               setToStorage(JSON.stringify(oridata))
               
           }
           else
           {
               array_part=(localStorageGetItem("particulars_ai"))
               if(isStringInList(document.getElementById("particulars_transaction").value, array_part)==true)
               {}
               else
               {
                   array_part.push(document.getElementById("particulars_transaction").value)
                   oridata = JSON.parse(localStorage.getItem("Wallet"))
                    oridata["particulars_ai"]=array_part
                    setToStorage(JSON.stringify(oridata))
                    
               }
           }
           new_object.Type = "Dr"
           data["TRXNUM"]+=1
           new_object.TRXNUM=data["TRXNUM"]
           new_object.Amount = document.getElementById("amount_transaction").value
           creditcardd = (document.getElementById("bank_select").options[document.getElementById("bank_select").selectedIndex].text)
           new_object.CreditCard = creditcardd
           new_object.Narration = document.getElementById("narration").value
           data["TRANSACTIONS"].push(new_object)
           data["TRANSACTIONS"].sort((a, b) => new Date(a.Date) - new Date(b.Date));
           cur_balance = data[creditcardd]["BalanceOutstanding"]
           cur_balance+=parseFloat(document.getElementById("amount_transaction").value)
           data[creditcardd]["BalanceOutstanding"] = cur_balance
           oridata = JSON.parse(localStorage.getItem("Wallet"))
           oridata["CREDIT CARDS"]=data
           setToStorage(JSON.stringify(oridata))
           
           alert("Added!")
           window.location.reload()     
       }
   }
   function sms()
   {
    event.preventDefault()
    window.location.href="SMSTransaction.html?type=CC"
   }
   function money_out()
   {
       event.preventDefault()
       document.getElementById("details_div").innerHTML=""
       document.getElementById("details_div").innerHTML+='\
       <br>\
       <h2 class="centre">Transaction made using card</h2>\
       <br>\
       <form class="centre"><button class="button" onclick="sms()">Read Transaction from SMS</button>\
        <br><br></form>\
       <form><label>Enter the date of the transaction</form><input id="date_transaction" class="margin: auto; display: block;" type="date" placeholder="Enter the date of the transaction"></form>\
       <br><input id="particulars_transaction" class="margin: auto; display: block;" type="text" placeholder="Where did you spent this?">\
       <br><ul id="list"></ul>\
       <br><input id="amount_transaction" class="margin: auto; display: block;" type="number" placeholder="Enter the amount">\
       <br><select id="bank_select" class="margin: auto; display: block;"><option>Select a credit card</option></select>\
       <br><input id="narration" class="margin: auto; display: block;" type="text" placeholder="Enter narration"></p>\
       <br><button onclick="moneyadded_out()">Add transaction</button>'
       dates=[]
       data = (localStorageGetItem("CREDIT CARDS"))
        for (keey in data)
        {
            if(keey == "NO_OF_CARDS"|| keey=="TRANSACTIONS" || keey=="TRXNUM")
            {

            }
            else
            {
                var newElement = document.createElement("option")
                newElement.innerHTML = keey
                dates.push(data[keey]["DueDate"])
                document.getElementById("bank_select").add(newElement)
            }
            
        }
        
        
        if (localStorageGetItem("particulars_ai")==null)
       {
   
       }
       else
       {
           var listItems = (localStorageGetItem("particulars_ai"))
            var listElement = document.getElementById('list');
             var searchInput = document.getElementById('particulars_transaction');
   
   // Function to filter the list based on search input
            function filterList() {
                var searchValue = searchInput.value.toLowerCase();
                var filteredList = listItems.filter(function(item) {
                return item.toLowerCase().includes(searchValue);
                });
                renderList(filteredList);
            }
            function addText(text)
            {
                document.getElementById("particulars_transaction").value = text
            }
            // Function to render the list
            function renderList(items) {
                listElement.innerHTML = '';
                items.forEach(function(item) {
                var li = document.createElement('li');
                li.textContent = item;
                li.addEventListener("click", function(){addText(li.textContent)})
                listElement.appendChild(li);
                });
            }
            
            // Event listener for search input
            searchInput.addEventListener('input', filterList);
            
            // Initial list rendering
            renderList(listItems);
       }
   }
   
   if(localStorageGetItem("CREDIT CARDS")==null)
   {
       alert("You have not setup a credit card. Please add atleast 1 credit card")
       window.location.href="Settings.html?addType=CC"
   }
   else
   {
           
           }
    //     if(data["TRANSACTIONS"].length==0)
    //    {
    //        document.getElementById("transactions_table").style.visibility="hidden"
    //        var no_trx = document.createElement("h2")
    //        no_trx.innerHTML="No transactions found"
    //        no_trx.style.cssText = 'text-align:center;';
    //        document.getElementById("details_div").appendChild(no_trx)
           
    //    }
    //    else
    //    {

    //        trx = data["TRANSACTIONS"]
    //        
    //    }
   
   function add(item)
   {
        if(item["Particulars"]=="Modifying Entry"&&item["Narration"]=="Being modification entry passed")
       {
        
       }
       else
       {
        var newRow = document.createElement("tr")
       var newDate = document.createElement("td")
       try{
        date = `${item["Date"].split("-")[2]}-${item["Date"].split("-")[1]}-${item["Date"].split("-")[0]}`
        newDate.innerHTML=date
       }
       catch
       {
        newDate.innerHTML=""
       }
       
       var newParticulars = document.createElement("td")
       newParticulars.innerHTML=item["Particulars"]
       var newBank = document.createElement("td")
       newBank.innerHTML=(item["CreditCard"]).split(" - ")[0]
       var newType = document.createElement("td")
       newType.innerHTML=item["Type"]
       var newAmount = document.createElement("td")
       newAmount.innerHTML=item["Amount"]
       var newB = document.createElement("td")
       var newButton = document.createElement("button")
       newButton.innerHTML="🔍\nActions:\nView and Delete"
       newButton.addEventListener("click", function(){window.location.href=`ViewTransaction.html?type=CC&trxnum=${item["TRXNUM"]}`})
       newRow.appendChild(newDate)
       newRow.appendChild(newParticulars)
       newRow.appendChild(newBank)
       newRow.appendChild(newType)
       newRow.appendChild(newAmount)
       newB.appendChild(newButton)
       newRow.appendChild(newB)
       document.getElementById("ttbody").appendChild(newRow)   
       }
       
   }
   
    data = (localStorageGetItem("CREDIT CARDS"))
    const cardDetails = Object.entries(data)
    .filter(([key]) => key !== "NO_OF_CARDS" && key !== "TRANSACTIONS" && key!="TRXNUM")
    .map(([card, details, balance]) => ({
        card,
        dueDate: new Date(details.DueDate),
        balance: details.BalanceOutstanding
    }));
    if(cardDetails.length==0)
    {
        alert("You have not setup a credit card. Please add atleast 1 credit card")
       window.location.href="Settings.html"
    }
    // another = cardDetails
    cardDetails.sort((a, b) => b.dueDate - a.dueDate);

table=document.createElement("table")
table.classList.add("card")
table.classList.add("centeer")

thead=document.createElement("thead")
tr=document.createElement("tr")

th_name=document.createElement("th")
th_name.innerHTML = "Card Name"
th_nickname=document.createElement("th")
th_nickname.innerHTML = "Outstanding"
th_duedays=document.createElement("th")
th_duedays.innerHTML = "Payment Due Date"
th_actions=document.createElement("th")
th_actions.innerHTML = "Edit Card"
// th_duedate=document.createElement("th")
// th_duedate.innerHTML = "Due Date"
tr.append(th_name,th_nickname,th_duedays, th_actions)
thead.append(tr)
table.append(thead)
tbody=document.createElement("tbody")

cardDetails.forEach(({ card, dueDate, balance}) => {    
    const formattedDate = `${dueDate.getDate()}-${dueDate.getMonth()+1}-${dueDate.getFullYear()}`
    var daystogo = parseInt((dueDate.getTime()-new Date().getTime())/(1000*60*60*24)+1)
    htmlcard = document.createElement("div")
    htmlcard.classList.add("card")
    htmlcard.classList.add("dotted")
    htmlcontainer = document.createElement("div")
    htmlcontainer.classList.add("container")
    htmlcardname = document.createElement("h4")
    htmlcardname.innerHTML = card
    htmlcontainer.appendChild(htmlcardname)
    htmlcard.appendChild(htmlcontainer)

    tr=document.createElement("tr")
    th_name=document.createElement("td")
    th_name.innerHTML = card
    th_name.addEventListener("click", function(){
        document.getElementById("card_name_selected").innerHTML=card
        document.getElementById("to_check").style.display="block"
    })
    th_nickname=document.createElement("td")
    th_nickname.innerHTML = balance
    th_duedays=document.createElement("td")
    if (daystogo<=5)
    {
        th_duedays.classList.add("red")
    }
    th_duedays.innerHTML = `${daystogo} days`
    th_action = document.createElement("button")
    th_action.innerHTML="<i class='fa-solid fa-pen-to-square'></i> Edit Card"
    th_action.addEventListener("click", function(){window.location.href=`Settings.html?modify=CC&${card}`})
    tr.append(th_name,th_nickname,th_duedays,th_action)
    tbody.append(tr)
    //document.getElementById("cur_balance").innerHTML+=htmlcard.innerHTML

});
table.append(tbody)
document.getElementById("cur_balance").append(table)



data = JSON.parse(localStorage.getItem("Wallet"))
    userName = data["user_id"]
    fetch(`https://nkafepwcnjcdvngvyrgz.supabase.co/rest/v1/UserData?user_id=eq.${userName}`, {
  method: "GET", // Specify the HTTP method
  headers: {
    "apikey": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im5rYWZlcHdjbmpjZHZuZ3Z5cmd6Iiwicm9sZSI6ImFub24iLCJpYXQiOjE2OTMyMjk4NTgsImV4cCI6MjAwODgwNTg1OH0.N0WVNuW3S-6Fa6sgMfnLcvORYk7oawfEeUAdJ-IUCH8", // Replace with your API key
    "Authorization": "Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im5rYWZlcHdjbmpjZHZuZ3Z5cmd6Iiwicm9sZSI6ImFub24iLCJpYXQiOjE2OTMyMjk4NTgsImV4cCI6MjAwODgwNTg1OH0.N0WVNuW3S-6Fa6sgMfnLcvORYk7oawfEeUAdJ-IUCH8", // Replace with your access token
    "Content-Type": "application/json",
    "Prefer": "return=minimal",
  }
})
.then(response => {
  if (!response.ok) {
    throw new Error("Network response was not ok");
  }
  return response.json();
})
.then(addata => {
    tocheck = JSON.parse(addata[0]["Details"])
    if(deepEqual(tocheck, data)==true)
    {
        
    } 
    else
    {
        localStorage.setItem("Wallet", JSON.stringify(tocheck))
        localforage.setItem("Wallet", JSON.stringify(tocheck), function(err, value){})
        window.location.reload()
    }
})  

</script>
</body>


</html>