<!DOCTYPE html>
<head>
   <title>Sign up for Wallet</title>
   <link rel="icon" href="../Assets/main-icon.png">
   <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.8.1/css/all.css">
   <script src="https://kit.fontawesome.com/420eab8243.js" crossorigin="anonymous"></script>
   <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<style>
    @import url('https://fonts.googleapis.com/css2?family=Open+Sans&display=swap');
   .centre
   {
   text-align: center;
   }
   .center{
   margin: auto;
   width: 30%;
   align-items: center;  
   padding: 10px;
   }   
   .rectangle {
   width: 200px;
   height: 100px;
   border: 1px solid black;
   text-align: center;
   display: inline-block;
   line-height: 50px;
   font-weight: bold;
   font-size: 20px;
   }
   .required::after {
   color: red;
   }
   
   *{
   list-style: none;
   text-decoration: none;
   margin: 0;
   padding: 0;
   box-sizing: border-box;
   font-family: 'Open Sans', sans-serif;
   }
   body{
   background: #f5f6fa;
   }
   .wrapper .sidebar{
   background: rgb(5, 68, 104);
   position: fixed;
   top: 0;
   left: 0;
   width: 225px;
   height: 100%;
   padding: 20px 0;
   transition: all 0.5s ease;
   }
   .wrapper .sidebar .profile{
   margin-bottom: 30px;
   text-align: center;
   }
   .wrapper .sidebar .profile img{
   display: block;
   width: 100px;
   height: 100px;
   border-radius: 50%;
   margin: 0 auto;
   }
   .wrapper .sidebar .profile h3{
   color: #ffffff;
   margin: 10px 0 5px;
   }
   .wrapper .sidebar .profile p{
   color: rgb(206, 240, 253);
   font-size: 14px;
   }
   .wrapper .sidebar ul li a{
   display: block;
   padding: 13px 30px;
   border-bottom: 1px solid #10558d;
   color: rgb(241, 237, 237);
   font-size: 16px;
   position: relative;
   }
   .wrapper .sidebar ul li a .icon{
   color: #dee4ec;
   width: 30px;
   display: inline-block;
   }
   .wrapper .sidebar ul li a:hover,
   .wrapper .sidebar ul li a.active{
   color: #0c7db1;
   background:white;
   border-right: 2px solid rgb(5, 68, 104);
   }
   .wrapper .sidebar ul li a:hover .icon,
   .wrapper .sidebar ul li a.active .icon{
   color: #0c7db1;
   }
   .wrapper .sidebar ul li a:hover:before,
   .wrapper .sidebar ul li a.active:before{
   display: block;
   }
   .collapsible {
   display: none;
   }
   .collapsible.active {
   display: block;
   }
   .collapsible-button {
   background-color: transparent;
   border: none;
   color: #000;
   font-size: 24px;
   cursor: pointer;
   position: absolute;
   top: 10px;
   left: 10px;
   }
   .pill-nav a {
  display: inline-block;
  color: black;
  text-align: center;
  padding: 14px;
  text-decoration: none;
  font-size: 17px;
  border-radius: 5px;
}

.pill-nav a:hover {
  background-color: #ddd;
  color: black;
}

.pill-nav a.active {
  background-color: dodgerblue;
  color: white;
}
</style>
<body>
   <header>
      <h1 class="centre">Welcome to Wallet</h1>
      <p class="centre">This app helps you manage all your financial transactions with ease</p>
      <p class="centre">Works with:-
      <li class="centre">Credit Cards</li>
      <li class="centre">Banks, Debit Cards</li>
      <li class="centre">Cash</li>
      </p>
      <p class="centre">The app is compatible with <i class="fa-brands fa-windows"></i> Windows, <i class="fa-brands fa-android"></i> Android, <i class="fa-brands fa-apple"></i> iOS, iPadOS, macOS, <i class="fa-brands fa-linux"></i> Linux, <i class="fa-solid fa-globe"></i> and on all devices that support the Web</p>
   </header>
   <button class="collapsible-button" id="coll-button">&#9776;</button>
   <div class="collapsible">
      <div class="wrapper">
         <!--Top menu -->
         <div class="sidebar">
            <button class="collapsible-button" id="dis-collapsible-button" style="color:white">&#9776;</button>
            <br>
            <div class="profile">
                <i class="fa-regular fa-user fa-2xl" style="color: #f7f9fd;"></i>
                <br>    
                <h3 id="name_ussser"></h3>
                <p id="user_name"></p>
                <br>
                <button onclick="logoutFunction()" id="logout_btn" style="visibility: hidden;">App Settings</button>
            </div>
            <ul>
                <li>
                    <a href="../index.html">
                        <span class="icon"><i class="fas fa-home"></i></span>
                        <span class="item">Home</span>
                    </a>
                </li>
                <li>
                    <a href="CreditCard.html">
                        <span class="icon"><i class="fa-regular fa-credit-card"></i></span>
                        <span class="item">Credit Cards</span>
                    </a>
                </li>
                <li>
                    <a href="Bank.html">
                        <span class="icon"><i class="fa-solid fa-building-columns"></i></span>
                        <span class="item">Banks</span>
                    </a>
                </li>
                <li>
                    <a href="Cash.html">
                        <span class="icon"><i class="fa-solid fa-sack-dollar"></i></span>
                        <span class="item">Cash</span>
                    </a>
                </li>
                <li>
                    <a href="Settings.html" class="active">
                        <span class="icon"><i class="fa-solid fa-gear"></i></span>
                        <span class="item">Settings</span>
                    </a>
                </li>
            </ul>
        </div>
      </div>
   </div>
   </div>
   <br>
   <form id="details_form" class="centre">
      <div class="pill-nav">
         <a class="active" onclick="personaloption()" id="personal_settings">Personal Settings</a>
         <a onclick="financialoption()" id="financial_settings">Financial Options</a>
         <a onclick="" id="about_settings">About</a>
         <a onclick="logoutoption()" id="logout_settings">Logout</a>
       </div>
       <div id="personalsettingsform">
         <h2>Manage your personal settings:</h2>
      <br>
      <label for="name_user">Name:</label>
      <input id="name_user" type="text">
      <br>
      <br>
      <label for="usernamee_entry">Username:</label>
      <input id="usernamee_entry" type="text">
      <br><br>
      <label for="password_user">Enter a strong password</label>
      <input id="password_user" type="password">
      <br><br>
      <button onclick="submitName()">Submit</button>
      <br>
      <br>

       </div>
      
      
      
      <br>
      <div id="financialsettingsform">
         <h2 style="visibility: hidden;" id="add_details_1">Add a financial option</h2>
         <br>
         <select style="visibility: hidden;" id="type_of_finance" onchange="change_option()">
            <option>Select a financial option</option>
            <option>Credit Cards</option>
            <option>Banks</option>
            <option>Cash</option>
         </select>
      </div>

      <div id="logoutform" style="visibility:hidden">
         <h2>Wallet Settings</h2>
         <button id="dlbutton" onclick="darkMode()"></button>
         <br>
         <br>
         <button onclick="logoutFunction()" >Logout from this device</button>
         <br><br>
         <button onclick="del_data()">Delete data and logout</button>
         <br>
      </div>
   </form>
   <div class="centre" id="to_delete"></div>
   
</body>
<script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script>
<script src="../Assets/functions.js"></script>
<script src="../localforage.js"></script>

<script>
   
   function loginPage()
   {
      event.preventDefault()
      window.location.href="Login.html"
   }
   function initialseset(data, typeed)
   {
      if(typeed=="")
      {
         userName = JSON.parse(data)["user_id"]
      localStorage.setItem("Wallet", data)
      localforage.setItem("Wallet", data, function(err, value){})
      fetch(`https://nkafepwcnjcdvngvyrgz.supabase.co/rest/v1/UserData?user_id=eq.${userName}`, {
  method: "GET", // Specify the HTTP method
  headers: {
    "apikey": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im5rYWZlcHdjbmpjZHZuZ3Z5cmd6Iiwicm9sZSI6ImFub24iLCJpYXQiOjE2OTMyMjk4NTgsImV4cCI6MjAwODgwNTg1OH0.N0WVNuW3S-6Fa6sgMfnLcvORYk7oawfEeUAdJ-IUCH8", // Replace with your API key
    "Authorization": "Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im5rYWZlcHdjbmpjZHZuZ3Z5cmd6Iiwicm9sZSI6ImFub24iLCJpYXQiOjE2OTMyMjk4NTgsImV4cCI6MjAwODgwNTg1OH0.N0WVNuW3S-6Fa6sgMfnLcvORYk7oawfEeUAdJ-IUCH8", // Replace with your access token
    "Content-Type": "application/json",
    "Prefer": "return=minimal",
  }
})
.then(response => {
  if (!response.ok) {
    throw new Error("Network response was not ok");
  }
  return response.json();
})
.then(addata => {
  if (addata.length==0)
  {
   fetch("https://nkafepwcnjcdvngvyrgz.supabase.co/rest/v1/UserData", {
      method: "POST",
      body: JSON.stringify({ "user_id": userName, "Details": data}),
      headers: {
      "apikey": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im5rYWZlcHdjbmpjZHZuZ3Z5cmd6Iiwicm9sZSI6ImFub24iLCJpYXQiOjE2OTMyMjk4NTgsImV4cCI6MjAwODgwNTg1OH0.N0WVNuW3S-6Fa6sgMfnLcvORYk7oawfEeUAdJ-IUCH8",
      "Authorization": "Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im5rYWZlcHdjbmpjZHZuZ3Z5cmd6Iiwicm9sZSI6ImFub24iLCJpYXQiOjE2OTMyMjk4NTgsImV4cCI6MjAwODgwNTg1OH0.N0WVNuW3S-6Fa6sgMfnLcvORYk7oawfEeUAdJ-IUCH8",
      "Content-Type": "application/json",
      "Prefer": "return=minimal",
   }
   });
  }
  else
  {
   alert("Sorry, that username is not available. Try another")
   document.getElementById("about_settings").classList.remove("active")
      document.getElementById("logout_settings").classList.remove("active")
      document.getElementById("financial_settings").classList.remove("active")
      document.getElementById("personal_settings").classList.add("active")
      var personalDiv = document.getElementById("personalsettingsform");
      var otherDiv = document.getElementById("financialsettingsform");
      personalDiv.style.display = "block";
      otherDiv.style.display = "none";
  }
})
.catch(error => {
  console.error("Fetch error:", error);
});

      }
      
   else
   {
      userName = JSON.parse(data)["user_id"]
      localStorage.setItem("Wallet", data)
      localforage.setItem("Wallet", data, function(err, value){})
      fetch(`https://nkafepwcnjcdvngvyrgz.supabase.co/rest/v1/UserData?user_id=eq.${userName}`, {
  method: "PATCH", 
  body: JSON.stringify({ "user_id": userName, "Details": data}),
  headers: {
    "apikey": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im5rYWZlcHdjbmpjZHZuZ3Z5cmd6Iiwicm9sZSI6ImFub24iLCJpYXQiOjE2OTMyMjk4NTgsImV4cCI6MjAwODgwNTg1OH0.N0WVNuW3S-6Fa6sgMfnLcvORYk7oawfEeUAdJ-IUCH8", // Replace with your API key
    "Authorization": "Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im5rYWZlcHdjbmpjZHZuZ3Z5cmd6Iiwicm9sZSI6ImFub24iLCJpYXQiOjE2OTMyMjk4NTgsImV4cCI6MjAwODgwNTg1OH0.N0WVNuW3S-6Fa6sgMfnLcvORYk7oawfEeUAdJ-IUCH8", // Replace with your access token
    "Content-Type": "application/json",
    "Prefer": "return=minimal",
  }
})
.then(response => {
  if (!response.ok) {
    throw new Error("Network response was not ok");
  }
  return response.json();
})
.then(addata => {
  if (addata.length==0)
  {
   fetch("https://nkafepwcnjcdvngvyrgz.supabase.co/rest/v1/UserData", {
      method: "POST",
      body: JSON.stringify({ "user_id": userName, "Details": data}),
      headers: {
      "apikey": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im5rYWZlcHdjbmpjZHZuZ3Z5cmd6Iiwicm9sZSI6ImFub24iLCJpYXQiOjE2OTMyMjk4NTgsImV4cCI6MjAwODgwNTg1OH0.N0WVNuW3S-6Fa6sgMfnLcvORYk7oawfEeUAdJ-IUCH8",
      "Authorization": "Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im5rYWZlcHdjbmpjZHZuZ3Z5cmd6Iiwicm9sZSI6ImFub24iLCJpYXQiOjE2OTMyMjk4NTgsImV4cCI6MjAwODgwNTg1OH0.N0WVNuW3S-6Fa6sgMfnLcvORYk7oawfEeUAdJ-IUCH8",
      "Content-Type": "application/json",
      "Prefer": "return=minimal",
   }
   });
  }
  else
  {
   alert("Sorry, that username is not available. Try another")
   document.getElementById("about_settings").classList.remove("active")
      document.getElementById("logout_settings").classList.remove("active")
      document.getElementById("financial_settings").classList.remove("active")
      document.getElementById("personal_settings").classList.add("active")
      var personalDiv = document.getElementById("personalsettingsform");
      var otherDiv = document.getElementById("financialsettingsform");
      personalDiv.style.display = "block";
      otherDiv.style.display = "none";
  }
})
.catch(error => {
  console.error("Fetch error:", error);
});
   }
      
   }
   function setToStorage(data)
   {
      userName = JSON.parse(data)["user_id"]
      localStorage.setItem("Wallet", data)
      localforage.setItem("Wallet", data, function(err, value){})      
      fetch(`https://nkafepwcnjcdvngvyrgz.supabase.co/rest/v1/UserData?user_id=eq.${userName}`, {
      method: "PATCH",
      body: JSON.stringify({ "user_id": userName, "Details": data}),
      headers: {
      "apikey": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im5rYWZlcHdjbmpjZHZuZ3Z5cmd6Iiwicm9sZSI6ImFub24iLCJpYXQiOjE2OTMyMjk4NTgsImV4cCI6MjAwODgwNTg1OH0.N0WVNuW3S-6Fa6sgMfnLcvORYk7oawfEeUAdJ-IUCH8",
      "Authorization": "Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im5rYWZlcHdjbmpjZHZuZ3Z5cmd6Iiwicm9sZSI6ImFub24iLCJpYXQiOjE2OTMyMjk4NTgsImV4cCI6MjAwODgwNTg1OH0.N0WVNuW3S-6Fa6sgMfnLcvORYk7oawfEeUAdJ-IUCH8",
      "Content-Type": "application/json",
      "Prefer": "return=minimal",
   }
   });
   }
   function localStorageGetItem(vallue)
   {
      return JSON.parse(localStorage.getItem("Wallet"))[vallue]
   }
    try{Notification.requestPermission().then((result) => {});}
    catch{}

    
   const collapsibleButton = document.querySelector('.collapsible-button');
   const menu = document.querySelector('.collapsible');
   
   collapsibleButton.addEventListener('click', () => {
   menu.classList.toggle('active');
   });
   
   
   const discollapisbleButton = document.getElementById("dis-collapsible-button");
   discollapisbleButton.addEventListener('click', () => {
   menu.classList.remove('active')
   });


</script>
<script>
   
   function personaloption()
   {
      document.getElementById("about_settings").classList.remove("active")
      document.getElementById("logout_settings").classList.remove("active")
      document.getElementById("financial_settings").classList.remove("active")
      document.getElementById("personal_settings").classList.add("active")
      var personalDiv = document.getElementById("personalsettingsform");
      var otherDiv = document.getElementById("financialsettingsform");
      var logoutdiv = document.getElementById("logoutform");
      personalDiv.style.display = "block";
      otherDiv.style.display = "none";
   }
   function logoutoption()
   {
      if(localStorage.getItem("Wallet")!=null)
      {
         document.getElementById("about_settings").classList.remove("active")
         document.getElementById("logout_settings").classList.add("active")
         document.getElementById("financial_settings").classList.remove("active")
         document.getElementById("personal_settings").classList.remove("active")
         var personalDiv = document.getElementById("personalsettingsform");
         var otherDiv = document.getElementById("financialsettingsform");
         var logoutdiv = document.getElementById("logoutform");
         personalDiv.style.display = "none";
         logoutdiv.style.visibility="visible";
         otherDiv.style.display = "none";
      }
    else
    {
      
    }  
   }
   function financialoption()
   {
      if(urlparams!="")
      {
         
      }
      else
      {
         if (localStorageGetItem("NameUser") != null) {
            var personalDiv = document.getElementById("personalsettingsform");
            var logoutdiv = document.getElementById("logoutform");
              var otherDiv = document.getElementById("financialsettingsform");
              document.getElementById("financial_settings").classList.add("active")
              document.getElementById("personal_settings").classList.remove("active")
              document.getElementById("about_settings").classList.remove("active")
               document.getElementById("logout_settings").classList.remove("active")
              personalDiv.style.display = "none";
            otherDiv.style.display = "block";
         document.getElementById("add_details_1").style.visibility = "visible";
         document.getElementById("type_of_finance").style.visibility = "visible";
      }
         
      }
   }
   if (localStorage.getItem("Wallet") != null) {
      document.getElementById("name_user").value = localStorageGetItem("NameUser") 
      document.getElementById("logout_btn").style.visibility="visible"
   document.getElementById("name_ussser").innerHTML = localStorageGetItem("NameUser")
   document.getElementById("usernamee_entry").value = localStorageGetItem("user_id")  
   document.getElementById("user_name").innerHTML = localStorageGetItem("user_id")
   document.getElementById("password_user").value = localStorageGetItem("password_user")  
}


   var urlparams = window.location.search
   if(urlparams=="")
   {
      
   }
   else
   {  
      var personalDiv = document.getElementById("personalsettingsform");
      var logoutdiv = document.getElementById("logoutform");
      var otherDiv = document.getElementById("financialsettingsform");
      document.getElementById("financial_settings").classList.add("active")
      document.getElementById("personal_settings").classList.remove("active")
      personalDiv.style.display = "none";
      var logoutdiv = document.getElementById("logoutform");
      otherDiv.style.display = "block";      
      document.getElementById("name_user").value = localStorageGetItem("NameUser") 
      type=(urlparams.split("?")[1]).split("=")[0]
      tod = (urlparams.split("?")[1]).split("=")[1]
      var spacer = document.createElement("br")
      if(type=="modify")
      {
         ti = tod.split("&")[0]
         ins = tod.split("&")[1]
         if(ti=="CC")
         {  
            creditcard = ins.replace(/%20/g, ' ');  
         document.getElementById("add_details_1").style.visibility = "visible";
         document.getElementById("add_details_1").innerHTML="Edit Credit Card"
         var creditcard_entry = document.createElement("select")
         creditcard_entry.id = "creditcard_entry"
         var optionss = ["Credit Card Bank", "HDFC Bank", "SBI", "American Express", "ICICI Bank", "Axis Bank", "Citibank", "YES Bank", "SCB", "IndusInd Bank", "RBL Bank", "Bank of Baroda", "Vijaya Bank", "Allahabad Bank", "Andhra Bank", "Bajaj Finserv", "Bank of India", "Bank of Maharashtra", "Canara Bank", "Central Bank of India", "Federal Bank", "HSBC Bank", "IDFC Bank", "Kotak Mahindra Bank"]
         for (var i = 0; i < optionss.length; i++) {
            var option = document.createElement("option");
            option.value = optionss[i];
            option.text = optionss[i];
            creditcard_entry.appendChild(option);
         }
         var nickname_entry = document.createElement("input")
         nickname_entry.id = "nickname_entry"
         nickname_entry.placeholder = "Enter a nickname for your card"
         nickname_entry.width = "150px"
         nickname_entry.type = "text"
         var spacer = document.createElement("br")
         var due_date = document.createElement("select")
         due_date.id = "due_date_checker"
         var options = ["Monthly Billing Date?", "1", "2", "3", "4", "5", "6", "7", "8", "9", "10", "11", "12", "13", "14", "15", "16", "17", "18", "19", "20", "21", "22", "23", "24", "25", "26", "27", "28", "29", "30", "31"];
         for (var i = 0; i < options.length; i++) {
            var option = document.createElement("option");
            option.value = options[i];
            option.text = options[i];
            due_date.appendChild(option);
         }
         var nickname = creditcard.substring(creditcard.indexOf("(") + 1, creditcard.lastIndexOf(")"))
         sss =(creditcard.replace(`(${nickname})`, "")).trim()
         document.getElementById("to_delete").appendChild(creditcard_entry)
         creditcard_entry.value=sss
         document.getElementById("to_delete").appendChild(spacer)
         document.getElementById("to_delete").appendChild(nickname_entry)
         nickname_entry.value=nickname
         document.getElementById("to_delete").appendChild(spacer)
         document.getElementById("to_delete").appendChild(due_date)
         data = localStorageGetItem("CREDIT CARDS")
         details = data[creditcard]
         
         datedue = new Date(details.DueDate)
         dd = datedue.getDate()
         due_date.value=dd
         var submit_btn = document.createElement("button")
         submit_btn.id = "submit_btn"
         submit_btn.innerHTML = "Modify details"
         submit_btn.addEventListener("click", function () {
            if (nickname_entry.value == "" || creditcard_entry.value == "" || document.getElementById("due_date_checker").options[document.getElementById("due_date_checker").selectedIndex].text == "Monthly Billing Date?") {
               swal("Please fill all the fields", "Please fill out all the fields - Nickname, Credit Card Name and Monthly Bill Date", "info");
            } else {
               if(`${creditcard_entry.value} (${nickname_entry.value})`==creditcard) 
               {
                  todayDate = new Date()
                  tempDate = new Date()
                  tempDate.setDate(document.getElementById("due_date_checker").options[document.getElementById("due_date_checker").selectedIndex].text)
                  tempDate.setHours(0, 0, 0)
                  if (todayDate >= tempDate) {
                     tempDate.setMonth(tempDate.getMonth() + 1)
                     data[creditcard]["DueDate"] = tempDate.toString()
                  }
                  else {
                     data[creditcard]["DueDate"] = tempDate.toString()
                  }
               }
               else
               {
                  data[`${creditcard_entry.value} (${nickname_entry.value})`]=data[creditcard]
                  delete data[creditcard]
                  todayDate = new Date()
                  tempDate = new Date()
                  tempDate.setDate(document.getElementById("due_date_checker").options[document.getElementById("due_date_checker").selectedIndex].text)
                  tempDate.setHours(0, 0, 0)
                  if (todayDate >= tempDate) {
                     tempDate.setMonth(tempDate.getMonth() + 1)
                     data[`${creditcard_entry.value} (${nickname_entry.value})`]["DueDate"] = tempDate.toString()
                  }
                  else {
                     data[`${creditcard_entry.value} (${nickname_entry.value})`]["DueDate"] = tempDate.toString()
                  }
                  transactions = data.TRANSACTIONS
                  for (let i = 0; i < transactions.length; i++) {
                     if (transactions[i].CreditCard === creditcard) {
                        transactions[i].CreditCard = `${creditcard_entry.value} (${nickname_entry.value})`;
                     }
                  }  
               }
               oridata = JSON.parse(localStorage.getItem("Wallet"))
               oridata["CREDIT CARDS"]=data
               setToStorage(JSON.stringify(oridata))
               alert("Modified card details successfully!")
               history.back()
         }})
         document.getElementById("to_delete").appendChild(spacer)
         document.getElementById("to_delete").appendChild(submit_btn)
         document.getElementById("to_delete").appendChild(spacer)
         var del_btn = document.createElement("button")
         del_btn.id = "del_btn"
         del_btn.innerHTML = "Delete Card"
         del_btn.addEventListener("click", function(){
            if(confirm("Warning! Do you wish to delete this card?"))
            {
               for (let i = 0; i < data.TRANSACTIONS.length; i++) {
                  if (data.TRANSACTIONS[i].CreditCard === creditcard) {
                     data.TRANSACTIONS.splice(i, 1);
                  }
                }  
               delete data[creditcard]
               data.NO_OF_CARDS-=1
               oridata = JSON.parse(localStorage.getItem("Wallet"))
               if (data.NO_OF_CARDS==0)
               {
                  delete oridata["CREDIT CARDS"]
               }
               else
               {
                  oridata["CREDIT CARDS"]=data
               }
               setToStorage(JSON.stringify(oridata))
               alert("Deleted card successfully!")
               history.back()
          }
         })
         document.getElementById("to_delete").appendChild(del_btn)
         }
         else
         {
            creditcard = ins.replace(/%20/g, ' ');
         document.getElementById("add_details_1").style.visibility = "visible";
         document.getElementById("add_details_1").innerHTML="Edit Bank Account"
         var spacer = document.createElement("br")
         var creditcard_entry = document.createElement("select")
         creditcard_entry.id = "creditcard_entry"
         var optionss = ["Bank Account", "HDFC Bank", "SBI", "American Express", "ICICI Bank", "Axis Bank", "Citibank", "YES Bank", "SCB", "IndusInd Bank", "RBL Bank", "Bank of Baroda", "Vijaya Bank", "Allahabad Bank", "Andhra Bank", "Bajaj Finserv", "Bank of India", "Bank of Maharashtra", "Canara Bank", "Central Bank of India", "Federal Bank", "HSBC Bank", "IDFC Bank", "Kotak Mahindra Bank"]
         for (var i = 0; i < optionss.length; i++) {
            var option = document.createElement("option");
            option.value = optionss[i];
            option.text = optionss[i];
            creditcard_entry.appendChild(option);
         }
      var nickname_entry = document.createElement("input")
      nickname_entry.id = "nickname_entry"
      nickname_entry.placeholder = "Enter a nickname for your bank"
      nickname_entry.width = "150px"
      nickname_entry.type = "text"
      var spacer = document.createElement("br")
      var nickname = creditcard.substring(creditcard.indexOf("(") + 1, creditcard.lastIndexOf(")"))
      sss =(creditcard.replace(`(${nickname})`, "")).trim()
      document.getElementById("to_delete").appendChild(creditcard_entry)
      creditcard_entry.value=sss
      document.getElementById("to_delete").appendChild(spacer)
      document.getElementById("to_delete").appendChild(nickname_entry)
      nickname_entry.value=nickname
      document.getElementById("to_delete").appendChild(spacer)
      data = localStorageGetItem("BANKS")
      balance = data[creditcard]
      var submit_btn = document.createElement("button")
      submit_btn.id = "submit_btn"
      submit_btn.innerHTML = "Modify details"
      submit_btn.addEventListener("click", function () {
         if (nickname_entry.value == "" || creditcard_entry.value == "" ) {
            swal("Please fill all the fields", "Please fill out all the fields - Nickname and Bank Name", "info");
         } else {
            let newKey=creditcard_entry.value
            vflkvkrv = data[creditcard]
            data[`${creditcard_entry.value} (${nickname_entry.value})`]=vflkvkrv
            delete data[creditcard]
            transactions = data.TRANSACTIONS
            for (let i = 0; i < transactions.length; i++) {
               if (transactions[i].BankAccount === creditcard) {
                  transactions[i].BankAccount = `${creditcard_entry.value} (${nickname_entry.value})`;
               }
            }  
            oridata = JSON.parse(localStorage.getItem("Wallet"))
            oridata["BANKS"]=data
            setToStorage(JSON.stringify(oridata))
            alert("Modified bank details successfully!")
            history.back()
         }})
         document.getElementById("to_delete").appendChild(spacer)
         document.getElementById("to_delete").appendChild(submit_btn)
         document.getElementById("to_delete").appendChild(spacer)
         var del_btn = document.createElement("button")
         del_btn.id = "del_btn"
         del_btn.innerHTML = "Delete Bank"
         del_btn.addEventListener("click", function(){
            if(confirm("Warning! Do you wish to delete this bank?"))
            {
               for (let i = 0; i < data.TRANSACTIONS.length; i++) {
                  if (data.TRANSACTIONS[i].CreditCard === creditcard) {
                     data.TRANSACTIONS.splice(i, 1);
                  }
                }  
               delete data[creditcard]
               data.NO_OF_BANKACCOUNTS-=1
               oridata=JSON.parse(localStorage.getItem("Wallet"))
               if(data.NO_OF_BANKACCOUNTS==0)
               {
                  delete oridata["BANKS"]
               }
               else
               {
                  oridata["BANKS"]=data
               }
               setToStorage(JSON.stringify(oridata))
               alert("Deleted bank successfully!")
               history.back()
            }
         })
         document.getElementById("to_delete").appendChild(del_btn)
         }
      }
      else if (type=="addType")
      {
         if(tod=="CC")
         {
               var personalDiv = document.getElementById("personalsettingsform");
               var logoutdiv = document.getElementById("logoutform");
               var otherDiv = document.getElementById("financialsettingsform");
               document.getElementById("financial_settings").classList.add("active")
               document.getElementById("personal_settings").classList.remove("active")
               document.getElementById("about_settings").classList.remove("active")
               document.getElementById("logout_settings").classList.remove("active")
               personalDiv.style.display = "none";
               otherDiv.style.display = "block";
               document.getElementById("add_details_1").style.visibility = "visible";
               document.getElementById("add_details_1").innerHTML="Add Credit Card"
               var spacer = document.createElement("br")
               document.getElementById("details_form").appendChild(spacer)
         var creditcard_entry = document.createElement("select")
         creditcard_entry.id = "creditcard_entry"
         var optionss = ["Credit Card Bank", "HDFC Bank", "SBI", "American Express", "ICICI Bank", "Axis Bank", "Citibank", "YES Bank", "SCB", "IndusInd Bank", "RBL Bank", "Bank of Baroda", "Vijaya Bank", "Allahabad Bank", "Andhra Bank", "Bajaj Finserv", "Bank of India", "Bank of Maharashtra", "Canara Bank", "Central Bank of India", "Federal Bank", "HSBC Bank", "IDFC Bank", "Kotak Mahindra Bank", "Others (Please specify)"]
         for (var i = 0; i < optionss.length; i++) {
            var option = document.createElement("option");
            option.value = optionss[i];
            option.text = optionss[i];
            creditcard_entry.appendChild(option);
         }
         creditcard_entry.addEventListener("change", function(){
            if(creditcard_entry.options[creditcard_entry.selectedIndex].text=="Others (Please specify)")
            {
               vvv = prompt("Enter your credit card issuing bank")
            }
         })
         var nickname_entry = document.createElement("input")
         nickname_entry.id = "nickname_entry"
         nickname_entry.placeholder = "Enter a nickname for your card"
         nickname_entry.width = "150px"
         nickname_entry.type = "text"
         var spacer = document.createElement("br")
         var due_date = document.createElement("select")
         due_date.id = "due_date_checker"
         var options = ["Monthly Billing Date?", "1", "2", "3", "4", "5", "6", "7", "8", "9", "10", "11", "12", "13", "14", "15", "16", "17", "18", "19", "20", "21", "22", "23", "24", "25", "26", "27", "28", "29", "30", "31"];
         for (var i = 0; i < options.length; i++) {
            var option = document.createElement("option");
            option.value = options[i];
            option.text = options[i];
            due_date.appendChild(option);
         }
         document.getElementById("to_delete").innerHTML += "<br>"
         document.getElementById("to_delete").appendChild(spacer)
         document.getElementById("to_delete").appendChild(creditcard_entry)
         document.getElementById("to_delete").appendChild(nickname_entry)
         document.getElementById("to_delete").appendChild(spacer)
         document.getElementById("to_delete").appendChild(due_date)
         var submit_btn = document.createElement("button")
         submit_btn.id = "submit_btn"
         submit_btn.innerHTML = "Add details"
         submit_btn.addEventListener("click", function () {
         if (nickname_entry.value == "" || creditcard_entry.options[creditcard_entry.selectedIndex].text == "Credit Card Bank" || document.getElementById("due_date_checker").options[document.getElementById("due_date_checker").selectedIndex].text == "Monthly Billing Date?") {
            swal("Please fill all the fields", "Please fill out all the fields - Nickname, Credit Card Name and Monthly Bill Date", "info");
         } else {
            try
            {
               creditcard_entry.options[creditcard_entry.selectedIndex].text=vvv
            }
            catch
            {
               
            }
            if (localStorageGetItem("CREDIT CARDS") == null) {
               objeee = new Object()
               objeee.NO_OF_CARDS = 1
               objeee.TRXNUM = 0
               strrr = `${creditcard_entry.options[creditcard_entry.selectedIndex].text} (${nickname_entry.value})`
               objeee.TRANSACTIONS = []
               oobb = new Object()
               todayDate = new Date()
               tempDate = new Date()
               tempDate.setDate(document.getElementById("due_date_checker").options[document.getElementById("due_date_checker").selectedIndex].text)
               tempDate.setHours(0, 0, 0)
               if (todayDate >= tempDate) {
                  tempDate.setMonth(tempDate.getMonth() + 1)
                  oobb.DueDate = tempDate.toString()
               } else {
                  oobb.DueDate = tempDate.toString()
               }
               oobb.BalanceOutstanding = 0
               objeee[strrr] = oobb
               data = JSON.parse(localStorage.getItem("Wallet"))
               data["CREDIT CARDS"]=objeee
               data["setup"]="DONE"
               setToStorage(JSON.stringify(data))
               if (localStorageGetItem("NameUser") == null) {
                        swal("Enter your name and username", "Please enter your name and username to proceed", "info")
                     } else {
                        swal("Done", "Added successfully!", "success", {
                              buttons: {
                                 ok: true,
                              },

                           })
                           .then((value) => {
                              switch (value) {

                                 case "ok":
                                    window.location.href = "../index.html"
                                    break;
                              }
                           });

                     }
               


            } 
            else {
               oridata = JSON.parse(localStorage.getItem("Wallet"))
               data = localStorageGetItem("CREDIT CARDS")
               if (`${creditcard_entry.options[creditcard_entry.selectedIndex].text} (${nickname_entry.value})` in data) {
                  swal("You already have a card with same bank and nickname", "To fix this issue, try typing some other nicknames", "error");
               } else {
                  data["NO_OF_CARDS"] += 1
                  oobb = new Object()
                  todayDate = new Date()
                  tempDate = new Date()
                  tempDate.setDate(document.getElementById("due_date_checker").options[document.getElementById("due_date_checker").selectedIndex].text)
                  tempDate.setHours(0, 0, 0)
                  if (todayDate >= tempDate) {
                     tempDate.setMonth(tempDate.getMonth() + 1)
                     oobb.DueDate = tempDate.toString()
                  } else {
                     oobb.DueDate = tempDate.toString()
                  }
                  oobb.BalanceOutstanding = 0
                  data[`${creditcard_entry.options[creditcard_entry.selectedIndex].text} (${nickname_entry.value})`] = oobb
                  oridata["CREDIT CARDS"]=data
                  setToStorage(JSON.stringify(oridata))

                  if (localStorageGetItem("NameUser") == null) {
                           swal("Enter your name and username", "Please enter your name and username to proceed", "info")
                        } else {
                           swal("Done", "Added successfully!", "success", {
                                 buttons: {
                                    ok: true,
                                 },

                              })
                              .then((value) => {
                                 switch (value) {

                                    case "ok":
                                       window.location.href = "../index.html"
                                       break;
                                 }
                              });

                        }
               }
            }
         }

      })
      
         document.getElementById("to_delete").appendChild(spacer)
         document.getElementById("to_delete").appendChild(submit_btn)
         }
         else if(tod=="B")
         {
            document.getElementById("add_details_1").style.visibility = "visible";
               document.getElementById("add_details_1").innerHTML="Add Bank Account"
            var spacer = document.createElement("br")
         document.getElementById("details_form").appendChild(spacer)
         var creditcard_entry = document.createElement("select")
         creditcard_entry.id = "creditcard_entry"
         var optionss = ["Bank Account", "HDFC Bank", "SBI", "American Express", "ICICI Bank", "Axis Bank", "Citibank", "YES Bank", "SCB", "IndusInd Bank", "RBL Bank", "Bank of Baroda", "Vijaya Bank", "Allahabad Bank", "Andhra Bank", "Bajaj Finserv", "Bank of India", "Bank of Maharashtra", "Canara Bank", "Central Bank of India", "Federal Bank", "HSBC Bank", "IDFC Bank", "Kotak Mahindra Bank"]
         for (var i = 0; i < optionss.length; i++) {
            var option = document.createElement("option");
            option.value = optionss[i];
            option.text = optionss[i];
            creditcard_entry.appendChild(option);
         }
         var nickname_entry = document.createElement("input")
         nickname_entry.id = "nickname_entry"
         nickname_entry.placeholder = "Enter a nickname for your bank account"
         nickname_entry.width = "150px"
         nickname_entry.type = "text"


         var spacer = document.createElement("br")
         var balance_entry = document.createElement("input")
         balance_entry.id = "balance_entry"
         balance_entry.placeholder = "Enter your bank balance"
         balance_entry.width = "150px"
         balance_entry.type = "number"
         var spacer = document.createElement("br")
         document.getElementById("to_delete").appendChild(spacer)
         document.getElementById("to_delete").appendChild(creditcard_entry)
         document.getElementById("to_delete").appendChild(spacer)
         document.getElementById("to_delete").appendChild(nickname_entry)
         document.getElementById("to_delete").appendChild(spacer)
         document.getElementById("to_delete").appendChild(balance_entry)
         var details = document.createElement("p")

         document.getElementById("to_delete").appendChild(spacer)
         document.getElementById("to_delete").appendChild(details)
         var submit_btn = document.createElement("button")
         submit_btn.id = "submit_btn"
         submit_btn.innerHTML = "Add details"
         submit_btn.addEventListener("click", function () {
         if (nickname_entry.value == "" || creditcard_entry.options[creditcard_entry.selectedIndex].text == "Bank Account" || balance_entry.value == "") {
            swal("Please fill all the fields", "Please fill out all the fields - Nickname, Bank Name and Balance in bank", "info");
         } else {
            if (localStorageGetItem("BANKS") == null) {
               objeee = new Object()
               objeee.NO_OF_BANKACCOUNTS = 1
               objeee.TRXNUM = 0
               strrr = `${creditcard_entry.options[creditcard_entry.selectedIndex].text} (${nickname_entry.value})`
               objeee[strrr] = parseFloat(balance_entry.value)
               objeee.TRANSACTIONS = []
               data = JSON.parse(localStorage.getItem("Wallet"))
               data["BANKS"]=objeee
               data["setup"]="DONE"
               setToStorage(JSON.stringify(data))
               if (localStorageGetItem("NameUser") == null) {
                  swal("Enter your name and username", "Please enter your name and username to proceed", "info")
               } else {
                  swal("Done", "Added successfully!", "success", {
                        buttons: {
                           ok: true,
                        },

                     })
                     .then((value) => {
                        switch (value) {

                           case "ok":
                              window.location.href = "../index.html"
                              break;

                        }
                     });
               }

            } else {
               oridata = JSON.parse(localStorage.getItem("Wallet"))
               data = localStorageGetItem("BANKS")
               if (`${creditcard_entry.options[creditcard_entry.selectedIndex].text} (${nickname_entry.value})` in data) {
                  swal("You already have a bank with same nickname", "To fix this issue, try typing some other nicknames", "error");

               } else {
                  data["NO_OF_BANKACCOUNTS"] += 1
                  data[`${creditcard_entry.options[creditcard_entry.selectedIndex].text} (${nickname_entry.value})`] = parseFloat(balance_entry.value)
                  oridata["BANKS"]=data
                  oridata["setup"]="DONE"
                  setToStorage(JSON.stringify(oridata))
                  if (localStorageGetItem("NameUser") == null) {
                     swal("Enter your name and username", "Please enter your name and username to proceed", "info")
                  } else {
                     swal("Done", "Added successfully!", "success", {
                           buttons: {
                              ok: true,
                           },

                        })
                        .then((value) => {
                           switch (value) {

                              case "ok":
                                 window.location.href = "../index.html"
                                 break;

                           }
                        });
                  }

               }
            }
         }
      })
      
      document.getElementById("to_delete").appendChild(spacer)
      document.getElementById("to_delete").appendChild(submit_btn)
         }
         else
         {
            document.getElementById("add_details_1").style.visibility = "visible";
               document.getElementById("add_details_1").innerHTML="Add Cash Account"
            var spacer = document.createElement("br")
      var creditcard_entry = document.createElement("input")
      creditcard_entry.id = "creditcard_entry"
      creditcard_entry.placeholder = "Enter the amount of cash with you now"
      creditcard_entry.width = "150px"
      creditcard_entry.type = "text"
      var spacer = document.createElement("br")
      document.getElementById("to_delete").appendChild(spacer)
      document.getElementById("to_delete").appendChild(creditcard_entry)
      var submit_btn = document.createElement("button")
      submit_btn.id = "submit_btn"
      submit_btn.innerHTML = "Add details"
      submit_btn.addEventListener("click", function () {
         if (creditcard_entry.value == "") {
            swal("Please fill all the fields", "Please fill out the field of amount of cash with you", "info");
         } else {
            if (localStorageGetItem("CASH") != null) {
               swal("Warning", "This will overwrite your current cash balance and delete all your previous transactions recorded in Wallet. Continue?", "warning", {
                     buttons: {
                        cancel: "No, stay here",
                        ok: true,
                     },

                  })
                  .then((value) => {
                     switch (value) {

                        case "ok":
                           objeee = new Object()
                           objeee.CASH_BALANCE = parseInt(creditcard_entry.value)
                           objeee.TRXNUM = 0
                           objeee.TRANSACTIONS = []
                           data = JSON.parse(localStorage.getItem("Wallet"))
                           data["CASH"]=objeee
                           data["setup"]="DONE"
                           setToStorage(JSON.stringify(data))
                           swal("Done", "Added successfully!", "success", {
                                 buttons: {
                                    ok: true,
                                 },

                              })
                              .then((value) => {
                                 switch (value) {

                                    case "ok":
                                       window.location.href = "../index.html"
                                       break;

                                 }
                              });
                           break;

                        case "cancel":
                           break;
                     }
                  });
            } else {
               oridata = JSON.parse(localStorage.getItem("Wallet"))
               objeee = new Object()
               objeee.CASH_BALANCE = parseInt(creditcard_entry.value)
               objeee.TRXNUM = 0
               objeee.TRANSACTIONS = []
               oridata["CASH"]=objeee
               oridata["setup"]="DONE"
               setToStorage(JSON.stringify(oridata))
               if (localStorageGetItem("NameUser") == null) {
                  swal("Enter your name and username", "Please enter your name and username to proceed", "info")
               } else {
                  swal("Done", "Added successfully!", "success", {
                        buttons: {
                           ok: true,
                        },

                     })
                     .then((value) => {
                        switch (value) {

                           case "ok":
                              window.location.href = "../index.html"
                              break;
                        }
                     });
               }
            }
         }
      })


      document.getElementById("to_delete").appendChild(spacer)
      document.getElementById("to_delete").appendChild(submit_btn)
         }
      }       
}

function del_data() {
   event.preventDefault()
   swal("Warning", "Are you sure you wish to delete all the data stored on the device? Doing so, will log you out!", "warning", {
         buttons: {
            cancel: "Cancel",
            ok: true,
         },

      })
      .then((value) => {
         switch (value) {

            case "ok":
                  data = JSON.parse(localStorage.getItem("Wallet"))
                  userName = data["user_id"]
                  localStorage.removeItem("Wallet")
                  localforage.removeItem("Wallet", function(err, value){})
                  fetch(`https://nkafepwcnjcdvngvyrgz.supabase.co/rest/v1/UserData?user_id=eq.${userName}`, {
                  method: "DELETE", // Specify the HTTP method
                  headers: {
                     "apikey": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im5rYWZlcHdjbmpjZHZuZ3Z5cmd6Iiwicm9sZSI6ImFub24iLCJpYXQiOjE2OTMyMjk4NTgsImV4cCI6MjAwODgwNTg1OH0.N0WVNuW3S-6Fa6sgMfnLcvORYk7oawfEeUAdJ-IUCH8", // Replace with your API key
                     "Authorization": "Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im5rYWZlcHdjbmpjZHZuZ3Z5cmd6Iiwicm9sZSI6ImFub24iLCJpYXQiOjE2OTMyMjk4NTgsImV4cCI6MjAwODgwNTg1OH0.N0WVNuW3S-6Fa6sgMfnLcvORYk7oawfEeUAdJ-IUCH8", // Replace with your access token
                     "Content-Type": "application/json",
                     "Prefer": "return=minimal",
                  }
                  })
                  .then(res => res.text())
                  .then(res => {if (res==""){
                     console.log("Done")
                     window.location.reload()
               }})
                  // 
               
               break;

            case "cancel":
               break;
         }
      });

}



function submitName() {
   event.preventDefault();
   if (name_user.value == "" || usernamee_entry.value=="" || password_user.value=="") {
      swal("Enter your name, a username and a password", "Please enter your name, a username and a password to proceed", "info");
   } else {
      var personalDiv = document.getElementById("personalsettingsform");
      var otherDiv = document.getElementById("financialsettingsform");
      var logoutdiv = document.getElementById("logoutform");
      data = {"NameUser":name_user.value, "user_id":usernamee_entry.value, "password_user":password_user.value}
      if(localStorage.getItem("Wallet")==null)
      {
         initialseset(JSON.stringify(data), "")
      }
      else
      {
         initialseset(JSON.stringify(data), "modify")
      }
      document.getElementById("financial_settings").classList.add("active")
      document.getElementById("personal_settings").classList.remove("active")
      document.getElementById("about_settings").classList.remove("active")
      document.getElementById("logout_settings").classList.remove("active")
      personalDiv.style.display = "none"; 
      otherDiv.style.display = "block";
      document.getElementById("name_user").value = localStorageGetItem("NameUser")
      document.getElementById("add_details_1").style.visibility = "visible";
      document.getElementById("type_of_finance").style.visibility = "visible";
   }

}

function change_option() {
   var x = document.getElementById("type_of_finance").value;
   if (x == "Select a financial option") {
      swal("Select an option", "Please select a financial option to begin with", "info");
      document.getElementById("to_delete").replaceChildren()

   } else if (x == "Credit Cards") {
      try {
         document.getElementById("to_delete").replaceChildren()
      } catch {

      }
      var spacer = document.createElement("br")
      document.getElementById("details_form").appendChild(spacer)
      var creditcard_entry = document.createElement("select")
      creditcard_entry.id = "creditcard_entry"
      var optionss = ["Credit Card Bank", "HDFC Bank", "SBI", "American Express", "ICICI Bank", "Axis Bank", "Citibank", "YES Bank", "SCB", "IndusInd Bank", "RBL Bank", "Bank of Baroda", "Vijaya Bank", "Allahabad Bank", "Andhra Bank", "Bajaj Finserv", "Bank of India", "Bank of Maharashtra", "Canara Bank", "Central Bank of India", "Federal Bank", "HSBC Bank", "IDFC Bank", "Kotak Mahindra Bank", "Others (Please specify)"]
      for (var i = 0; i < optionss.length; i++) {
         var option = document.createElement("option");
         option.value = optionss[i];
         option.text = optionss[i];
         creditcard_entry.appendChild(option);
      }
      creditcard_entry.addEventListener("change", function(){
         if(creditcard_entry.options[creditcard_entry.selectedIndex].text=="Others (Please specify)")
         {
            vvv = prompt("Enter your credit card issuing bank")
         }
      })
      var nickname_entry = document.createElement("input")
      nickname_entry.id = "nickname_entry"
      nickname_entry.placeholder = "Enter a nickname for your card"
      nickname_entry.width = "150px"
      nickname_entry.type = "text"
      var spacer = document.createElement("br")
      var due_date = document.createElement("select")
      due_date.id = "due_date_checker"
      var options = ["Monthly Billing Date?", "1", "2", "3", "4", "5", "6", "7", "8", "9", "10", "11", "12", "13", "14", "15", "16", "17", "18", "19", "20", "21", "22", "23", "24", "25", "26", "27", "28", "29", "30", "31"];
      for (var i = 0; i < options.length; i++) {
         var option = document.createElement("option");
         option.value = options[i];
         option.text = options[i];
         due_date.appendChild(option);
      }
      document.getElementById("to_delete").innerHTML += "<br>"
      document.getElementById("to_delete").appendChild(spacer)
      document.getElementById("to_delete").appendChild(creditcard_entry)
      document.getElementById("to_delete").appendChild(nickname_entry)
      document.getElementById("to_delete").appendChild(spacer)
      document.getElementById("to_delete").appendChild(due_date)
      var submit_btn = document.createElement("button")
      submit_btn.id = "submit_btn"
      submit_btn.innerHTML = "Add details"
      submit_btn.addEventListener("click", function () {
         if (nickname_entry.value == "" || creditcard_entry.options[creditcard_entry.selectedIndex].text == "Credit Card Bank" || document.getElementById("due_date_checker").options[document.getElementById("due_date_checker").selectedIndex].text == "Monthly Billing Date?") {
            swal("Please fill all the fields", "Please fill out all the fields - Nickname, Credit Card Name and Monthly Bill Date", "info");
         } else {
            try
            {
               creditcard_entry.options[creditcard_entry.selectedIndex].text=vvv
            }
            catch
            {
               
            }
            if (localStorageGetItem("CREDIT CARDS") == null) {
               objeee = new Object()
               objeee.NO_OF_CARDS = 1
               objeee.TRXNUM = 0
               strrr = `${creditcard_entry.options[creditcard_entry.selectedIndex].text} (${nickname_entry.value})`
               objeee.TRANSACTIONS = []
               oobb = new Object()
               todayDate = new Date()
               tempDate = new Date()
               tempDate.setDate(document.getElementById("due_date_checker").options[document.getElementById("due_date_checker").selectedIndex].text)
               tempDate.setHours(0, 0, 0)
               if (todayDate >= tempDate) {
                  tempDate.setMonth(tempDate.getMonth() + 1)
                  oobb.DueDate = tempDate.toString()
               } else {
                  oobb.DueDate = tempDate.toString()
               }
               oobb.BalanceOutstanding = 0
               objeee[strrr] = oobb
               data = JSON.parse(localStorage.getItem("Wallet"))
               data["CREDIT CARDS"]=objeee
               data["setup"]="DONE"
               setToStorage(JSON.stringify(data))
               if (localStorageGetItem("NameUser") == null) {
                        swal("Enter your name and username", "Please enter your name and username to proceed", "info")
                     } else {
                        swal("Done", "Added successfully!", "success", {
                              buttons: {
                                 ok: true,
                              },

                           })
                           .then((value) => {
                              switch (value) {

                                 case "ok":
                                    window.location.href = "../index.html"
                                    break;
                              }
                           });

                     }
               


            } 
            else {
               oridata = JSON.parse(localStorage.getItem("Wallet"))
               data = localStorageGetItem("CREDIT CARDS")
               if (`${creditcard_entry.options[creditcard_entry.selectedIndex].text} (${nickname_entry.value})` in data) {
                  swal("You already have a card with same bank and nickname", "To fix this issue, try typing some other nicknames", "error");
               } else {
                  data["NO_OF_CARDS"] += 1
                  oobb = new Object()
                  todayDate = new Date()
                  tempDate = new Date()
                  tempDate.setDate(document.getElementById("due_date_checker").options[document.getElementById("due_date_checker").selectedIndex].text)
                  tempDate.setHours(0, 0, 0)
                  if (todayDate >= tempDate) {
                     tempDate.setMonth(tempDate.getMonth() + 1)
                     oobb.DueDate = tempDate.toString()
                  } else {
                     oobb.DueDate = tempDate.toString()
                  }
                  oobb.BalanceOutstanding = 0
                  data[`${creditcard_entry.options[creditcard_entry.selectedIndex].text} (${nickname_entry.value})`] = oobb
                  oridata["CREDIT CARDS"]=data
                  setToStorage(JSON.stringify(oridata))
                  if (localStorageGetItem("NameUser") == null) {
                           swal("Enter your name and username", "Please enter your name and username to proceed", "info")
                        } else {
                           swal("Done", "Added successfully!", "success", {
                                 buttons: {
                                    ok: true,
                                 },

                              })
                              .then((value) => {
                                 switch (value) {

                                    case "ok":
                                       window.location.href = "../index.html"
                                       break;
                                 }
                              });

                        }
               }
            }
         }

      })
      document.getElementById("to_delete").appendChild(spacer)
      document.getElementById("to_delete").appendChild(submit_btn)
   } else if (x == "Cash") {
      try {
         document.getElementById("to_delete").replaceChildren()
      } catch {

      }
      var spacer = document.createElement("br")
      var creditcard_entry = document.createElement("input")
      creditcard_entry.id = "creditcard_entry"
      creditcard_entry.placeholder = "Enter the amount of cash with you now"
      creditcard_entry.width = "150px"
      creditcard_entry.type = "text"
      var spacer = document.createElement("br")
      document.getElementById("to_delete").appendChild(spacer)
      document.getElementById("to_delete").appendChild(creditcard_entry)
      var submit_btn = document.createElement("button")
      submit_btn.id = "submit_btn"
      submit_btn.innerHTML = "Add details"
      submit_btn.addEventListener("click", function () {
         if (creditcard_entry.value == "") {
            swal("Please fill all the fields", "Please fill out the field of amount of cash with you", "info");
         } else {
            if (localStorageGetItem("CASH") != null) {
               swal("Warning", "This will overwrite your current cash balance and delete all your previous transactions recorded in Wallet. Continue?", "warning", {
                     buttons: {
                        cancel: "No, stay here",
                        ok: true,
                     },

                  })
                  .then((value) => {
                     switch (value) {

                        case "ok":
                           objeee = new Object()
                           objeee.CASH_BALANCE = parseInt(creditcard_entry.value)
                           objeee.TRXNUM = 0
                           objeee.TRANSACTIONS = []
                           data = JSON.parse(localStorage.getItem("Wallet"))
                           data["CASH"]=objeee
                           data["setup"]="DONE"
                           setToStorage(JSON.stringify(data))
                           swal("Done", "Added successfully!", "success", {
                                 buttons: {
                                    ok: true,
                                 },

                              })
                              .then((value) => {
                                 switch (value) {

                                    case "ok":
                                       window.location.href = "../index.html"
                                       break;

                                 }
                              });
                           break;

                        case "cancel":
                           break;
                     }
                  });
            } else {
               oridata = JSON.parse(localStorage.getItem("Wallet"))
               objeee = new Object()
               objeee.CASH_BALANCE = parseInt(creditcard_entry.value)
               objeee.TRXNUM = 0
               objeee.TRANSACTIONS = []
               oridata["CASH"]=objeee
               oridata["setup"]="DONE"
               setToStorage(JSON.stringify(oridata))
               if (localStorageGetItem("NameUser") == null) {
                  swal("Enter your name and username", "Please enter your name and username to proceed", "info")
               } else {
                  swal("Done", "Added successfully!", "success", {
                        buttons: {
                           ok: true,
                        },

                     })
                     .then((value) => {
                        switch (value) {

                           case "ok":
                              window.location.href = "../index.html"
                              break;
                        }
                     });
               }
            }
         }
      })

      document.getElementById("to_delete").appendChild(spacer)
      document.getElementById("to_delete").appendChild(submit_btn)
   } else if (x == "Banks") {
      try {
         document.getElementById("to_delete").replaceChildren()
      } catch {

      }
      var spacer = document.createElement("br")
      document.getElementById("details_form").appendChild(spacer)
      var creditcard_entry = document.createElement("select")
      creditcard_entry.id = "creditcard_entry"
      var optionss = ["Bank Account", "HDFC Bank", "SBI", "American Express", "ICICI Bank", "Axis Bank", "Citibank", "YES Bank", "SCB", "IndusInd Bank", "RBL Bank", "Bank of Baroda", "Vijaya Bank", "Allahabad Bank", "Andhra Bank", "Bajaj Finserv", "Bank of India", "Bank of Maharashtra", "Canara Bank", "Central Bank of India", "Federal Bank", "HSBC Bank", "IDFC Bank", "Kotak Mahindra Bank"]
      for (var i = 0; i < optionss.length; i++) {
         var option = document.createElement("option");
         option.value = optionss[i];
         option.text = optionss[i];
         creditcard_entry.appendChild(option);
      }
      var nickname_entry = document.createElement("input")
      nickname_entry.id = "nickname_entry"
      nickname_entry.placeholder = "Enter a nickname for your bank account"
      nickname_entry.width = "150px"
      nickname_entry.type = "text"
      var spacer = document.createElement("br")
      var balance_entry = document.createElement("input")
      balance_entry.id = "balance_entry"
      balance_entry.placeholder = "Enter your bank balance"
      balance_entry.width = "150px"
      balance_entry.type = "number"
      var spacer = document.createElement("br")
      document.getElementById("to_delete").appendChild(spacer)
      document.getElementById("to_delete").appendChild(creditcard_entry)
      document.getElementById("to_delete").appendChild(spacer)
      document.getElementById("to_delete").appendChild(nickname_entry)
      document.getElementById("to_delete").appendChild(spacer)
      document.getElementById("to_delete").appendChild(balance_entry)
      var submit_btn = document.createElement("button")
      submit_btn.id = "submit_btn"
      submit_btn.innerHTML = "Add details"
      submit_btn.addEventListener("click", function () {
         if (nickname_entry.value == "" || creditcard_entry.options[creditcard_entry.selectedIndex].text == "Bank Account" || balance_entry.value == "") {
            swal("Please fill all the fields", "Please fill out all the fields - Nickname, Bank Name and Balance in bank", "info");
         } else {
            if (localStorageGetItem("BANKS") == null) {
               objeee = new Object()
               objeee.NO_OF_BANKACCOUNTS = 1
               objeee.TRXNUM = 0
               strrr = `${creditcard_entry.options[creditcard_entry.selectedIndex].text} (${nickname_entry.value})`
               objeee[strrr] = parseFloat(balance_entry.value)
               objeee.TRANSACTIONS = []
               data = JSON.parse(localStorage.getItem("Wallet"))
               data["BANKS"]=objeee
               data["setup"]="DONE"
               setToStorage(JSON.stringify(data))
               if (localStorageGetItem("NameUser") == null) {
                  swal("Enter your name and username", "Please enter your name and username to proceed", "info")
               } else {
                  swal("Done", "Added successfully!", "success", {
                        buttons: {
                           ok: true,
                        },

                     })
                     .then((value) => {
                        switch (value) {

                           case "ok":
                              window.location.href = "../index.html"
                              break;

                        }
                     });
               }

            } else {
               oridata = JSON.parse(localStorage.getItem("Wallet"))
               data = localStorageGetItem("BANKS")
               if (`${creditcard_entry.options[creditcard_entry.selectedIndex].text} (${nickname_entry.value})` in data) {
                  swal("You already have a bank with same nickname", "To fix this issue, try typing some other nicknames", "error");

               } else {
                  data["NO_OF_BANKACCOUNTS"] += 1
                  data[`${creditcard_entry.options[creditcard_entry.selectedIndex].text} (${nickname_entry.value})`] = parseFloat(balance_entry.value)
                  oridata["BANKS"]=data
                  oridata["setup"]="DONE"
                  setToStorage(JSON.stringify(oridata))

                  if (localStorageGetItem("NameUser") == null) {
                     swal("Enter your name and username", "Please enter your name and username to proceed", "info")
                  } else {
                     swal("Done", "Added successfully!", "success", {
                           buttons: {
                              ok: true,
                           },

                        })
                        .then((value) => {
                           switch (value) {

                              case "ok":
                                 window.location.href = "../index.html"
                                 break;

                           }
                        });
                  }

               }
            }
         }
      })
      document.getElementById("to_delete").appendChild(spacer)
      document.getElementById("to_delete").appendChild(submit_btn)

   }
}

try
{
   data = JSON.parse(localStorage.getItem("Wallet"))
    userName = data["user_id"]
    fetch(`https://nkafepwcnjcdvngvyrgz.supabase.co/rest/v1/UserData?user_id=eq.${userName}`, {
  method: "GET", // Specify the HTTP method
  headers: {
    "apikey": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im5rYWZlcHdjbmpjZHZuZ3Z5cmd6Iiwicm9sZSI6ImFub24iLCJpYXQiOjE2OTMyMjk4NTgsImV4cCI6MjAwODgwNTg1OH0.N0WVNuW3S-6Fa6sgMfnLcvORYk7oawfEeUAdJ-IUCH8", // Replace with your API key
    "Authorization": "Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im5rYWZlcHdjbmpjZHZuZ3Z5cmd6Iiwicm9sZSI6ImFub24iLCJpYXQiOjE2OTMyMjk4NTgsImV4cCI6MjAwODgwNTg1OH0.N0WVNuW3S-6Fa6sgMfnLcvORYk7oawfEeUAdJ-IUCH8", // Replace with your access token
    "Content-Type": "application/json",
    "Prefer": "return=minimal",
  }
})
.then(response => {
  if (!response.ok) {
    throw new Error("Network response was not ok");
  }
  return response.json();
})
.then(addata => {
    tocheck = JSON.parse(addata[0]["Details"])
    if(deepEqual(tocheck, data)==true)
    {
        
    } 
    else
    {
        localStorage.setItem("Wallet", JSON.stringify(tocheck))
        localforage.setItem("Wallet", JSON.stringify(tocheck), function(err, value){})
        window.location.reload()
    }
})    
}
catch
{}
</script>
</html>